{% load static %}
<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>{{ page_title }} • Hizmetler</title>
    <link rel="stylesheet" href="{% static 'panel/dashboard.css' %}">
    <link rel="stylesheet" href="{% static 'panel/service.css' %}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
</head>
<body>
<aside class="sidebar">
    <div>
        <div class="brand">{{ hospital.name }}</div>
        <p style="margin:4px 0 0; color:#6C757D; font-size:13px;">{{ hospital.address }}</p>
    </div>
    <ul class="nav-links">
        <li><a href="{% url 'dashboard' %}"><i class="bi bi-speedometer2"></i> Genel Bakış</a></li>
        <li><a href="{% url 'hospital_settings' %}"><i class="bi bi-building"></i> Hastane Bilgileri</a></li>
        <li><a href="{% url 'doctor_management' %}"><i class="bi bi-person-badge"></i> Doktorlar</a></li>
        <li><a href="{% url 'appointment_management' %}"><i class="bi bi-calendar-check"></i> Randevular</a></li>
        <li><a href="{% url 'schedule_management' %}"><i class="bi bi-calendar3"></i> Çalışma Takvimi</a></li>
        <li><a class="active" href="{% url 'service_management' %}"><i class="bi bi-briefcase"></i> Hizmetler</a></li>
        <li><a href="{% url 'review_management' %}"><i class="bi bi-chat-left-text"></i> Yorumlar</a></li>
        <li><a href="{% url 'settings' %}"><i class="bi bi-gear"></i> Ayarlar</a></li>
    </ul>
    
    <!-- Tema Değiştirme -->
    <div class="theme-toggle">
        <button class="theme-btn" data-theme="light" title="Açık Tema">
            <i class="bi bi-sun-fill"></i>
        </button>
        <button class="theme-btn active" data-theme="dark" title="Koyu Tema">
            <i class="bi bi-moon-fill"></i>
        </button>
    </div>
</aside>
<div class="content">
    <div class="top-bar">
        <div>
            <p style="margin:0; color:#6C757D; font-size:13px;">Hizmet Yönetimi</p>
            <h1>{{ page_title }}</h1>
        </div>
    </div>

    {% if messages %}
        <div class="messages">
            {% for message in messages %}
                <div class="message {{ message.tags }}">{{ message }}</div>
            {% endfor %}
        </div>
    {% endif %}

    <section class="panel-card">
        <h2>Yeni Hizmet Ekle</h2>
        <form method="post">
            {% csrf_token %}
            <input type="hidden" name="form_type" value="create_service">
            {{ create_form.as_p }}
            <button type="submit" class="primary">Kaydet</button>
        </form>
    </section>

    <section class="service-grid">
        {% for card in service_cards %}
            <article class="service-card">
                <header>
                    <div>
                        <h3>{{ card.data.name }}</h3>
                        <p>{{ card.data.description }}</p>
                    </div>
                    <span class="price">{{ card.data.price }} ₺</span>
                </header>

                <details open>
                    <summary>Genel Bilgiler</summary>
                    <form method="post">
                        {% csrf_token %}
                        <input type="hidden" name="form_type" value="update_service">
                        {{ card.general_form.as_p }}
                        <button type="submit" class="primary">Güncelle</button>
                    </form>
                    <form method="post" class="inline-form">
                        {% csrf_token %}
                        <input type="hidden" name="form_type" value="delete_service">
                        <input type="hidden" name="service_id" value="{{ card.data.id }}">
                        <button type="submit" class="danger">Sil</button>
                    </form>
                </details>

                <details>
                    <summary>Atamalar</summary>
                    <form method="post">
                        {% csrf_token %}
                        <input type="hidden" name="form_type" value="update_assignments">
                        {{ card.assignment_form.as_p }}
                        <button type="submit" class="primary">Atamaları Kaydet</button>
                    </form>
                </details>

                <div class="assignment-summary">
                    <div>
                        <h4>Doktorlar</h4>
                        {% if card.assigned_doctors %}
                            <ul>
                                {% for doctor in card.assigned_doctors %}
                                    <li>{{ doctor.name }} {{ doctor.surname }}</li>
                                {% endfor %}
                            </ul>
                        {% else %}
                            <p class="empty-state">Doktor ataması yok</p>
                        {% endif %}
                    </div>
                    <div>
                        <h4>Hastaneler</h4>
                        {% if card.assigned_hospitals %}
                            <ul>
                                {% for hospital in card.assigned_hospitals %}
                                    <li>{{ hospital.name }}</li>
                                {% endfor %}
                            </ul>
                        {% else %}
                            <p class="empty-state">Hastane ataması yok</p>
                        {% endif %}
                    </div>
                </div>
            </article>
        {% empty %}
            <p class="empty-state">Henüz hizmet eklenmemiş.</p>
        {% endfor %}
    </section>
</div>

<script>
// Tema Yönetimi
(function() {
    const savedTheme = localStorage.getItem('theme') || 'dark';
    document.documentElement.setAttribute('data-theme', savedTheme);
    const themeButtons = document.querySelectorAll('.theme-btn');
    themeButtons.forEach(btn => {
        if (btn.dataset.theme === savedTheme) {
            btn.classList.add('active');
        } else {
            btn.classList.remove('active');
        }
    });
    themeButtons.forEach(btn => {
        btn.addEventListener('click', function() {
            const theme = this.dataset.theme;
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
            themeButtons.forEach(b => b.classList.remove('active'));
            this.classList.add('active');
        });
    });
})();
</script>
</body>
</html>
