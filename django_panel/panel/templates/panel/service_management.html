{% extends 'panel/base.html' %}
{% load static %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'panel/service.css' %}">
{% endblock %}

{% block top_bar_subtitle %}Hizmet Yönetimi{% endblock %}

{% block content %}
    <section class="service-grid">
        {% for card in service_cards %}
            <article class="service-card">
                <header>
                    <div>
                        <h3>{{ card.data.name }}</h3>
                        <p>{{ card.data.description }}</p>
                    </div>
                </header>

                <details>
                    <summary>Genel Bilgiler</summary>
                    <form method="post">
                        {% csrf_token %}
                        <input type="hidden" name="form_type" value="update_service">
                        {{ card.general_form.as_p }}
                        <button type="submit" class="primary">Güncelle</button>
                    </form>
                    <form method="post" class="inline-form" onsubmit="return confirm('Bu hizmeti silmek istediğinize emin misiniz?');">
                        {% csrf_token %}
                        <input type="hidden" name="form_type" value="delete_service">
                        <input type="hidden" name="service_id" value="{{ card.data.id }}">
                        <button type="submit" class="danger">Sil</button>
                    </form>
                </details>

                <details>
                    <summary>Atamalar</summary>
                    <form method="post">
                        {% csrf_token %}
                        <input type="hidden" name="form_type" value="update_assignments">
                        {{ card.assignment_form.as_p }}
                        <button type="submit" class="primary">Atamaları Kaydet</button>
                    </form>
                </details>

                <div class="assignment-summary">
                    <div>
                        <h4>Doktorlar</h4>
                        {% if card.assigned_doctors %}
                            <ul>
                                {% for doctor in card.assigned_doctors %}
                                    <li>{{ doctor.name }} {{ doctor.surname }}</li>
                                {% endfor %}
                            </ul>
                        {% else %}
                            <p class="empty-state">Doktor ataması yok</p>
                        {% endif %}
                    </div>
                </div>
            </article>
        {% empty %}
            <p class="empty-state">Henüz hizmet eklenmemiş.</p>
        {% endfor %}
    </section>
{% endblock %}
