{% load static %}
<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>{{ page_title }} • Çalışma Takvimi</title>
    <link rel="stylesheet" href="{% static 'panel/dashboard.css' %}">
    <link rel="stylesheet" href="{% static 'panel/schedule.css' %}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
</head>
<body>
<aside class="sidebar">
    <div>
        <div class="brand">{{ hospital.name }}</div>
        <p style="margin:4px 0 0; color:#6C757D; font-size:13px;">{{ hospital.address }}</p>
    </div>
    <ul class="nav-links">
        <li><a href="{% url 'dashboard' %}"><i class="bi bi-speedometer2"></i> Genel Bakış</a></li>
        <li><a href="{% url 'hospital_settings' %}"><i class="bi bi-building"></i> Hastane Bilgileri</a></li>
        <li><a href="{% url 'doctor_management' %}"><i class="bi bi-person-badge"></i> Doktorlar</a></li>
        <li><a href="{% url 'appointment_management' %}"><i class="bi bi-calendar-check"></i> Randevular</a></li>
        <li><a class="active" href="{% url 'schedule_management' %}"><i class="bi bi-calendar3"></i> Çalışma Takvimi</a></li>
        <li><a href="{% url 'service_management' %}"><i class="bi bi-briefcase"></i> Hizmetler</a></li>
        <li><a href="{% url 'review_management' %}"><i class="bi bi-chat-left-text"></i> Yorumlar</a></li>
        <li><a href="{% url 'settings' %}"><i class="bi bi-gear"></i> Ayarlar</a></li>
    </ul>
    
    <!-- Tema Değiştirme -->
    <div class="theme-toggle">
        <button class="theme-btn" data-theme="light" title="Açık Tema">
            <i class="bi bi-sun-fill"></i>
        </button>
        <button class="theme-btn active" data-theme="dark" title="Koyu Tema">
            <i class="bi bi-moon-fill"></i>
        </button>
    </div>
</aside>
<div class="content">
    <div class="top-bar">
        <div>
            <p style="margin:0; color:#6C757D; font-size:13px;">Takvim Yönetimi</p>
            <h1>{{ page_title }} - {{ calendar.month_name }} {{ calendar.year }}</h1>
        </div>
    </div>

    {% if messages %}
        <div class="messages">
            {% for message in messages %}
                <div class="message {{ message.tags }}">{{ message }}</div>
            {% endfor %}
        </div>
    {% endif %}

    <section class="panel-card">
        <h2>Filtreler</h2>
        <form method="get" class="filter-form">
            {{ filter_form.as_p }}
            <button type="submit" class="primary">Göster</button>
        </form>
    </section>

    <section class="panel-card">
        <h2>Takvim</h2>
        <div class="calendar-grid">
            <div class="calendar-header">
                <div>Pzt</div>
                <div>Sal</div>
                <div>Çar</div>
                <div>Per</div>
                <div>Cum</div>
                <div>Cmt</div>
                <div>Paz</div>
            </div>
            {% for week in calendar.weeks %}
                <div class="calendar-week">
                    {% for day in week %}
                        <div class="calendar-day {% if not day.is_current_month %}other-month{% endif %} {% if day.is_today %}today{% endif %} {% if day.is_past %}past{% endif %}">
                            <div class="day-number">{{ day.date.day }}</div>
                            {% if day.hospital_hours %}
                                <div class="hours-badge hospital {% if day.has_full_day_holiday %}cancelled{% endif %}">H: {{ day.hospital_hours }}</div>
                            {% endif %}
                            {% if day.doctor_hours %}
                                <div class="hours-badge doctor {% if day.has_full_day_holiday %}cancelled{% endif %}">D: {{ day.doctor_hours }}</div>
                            {% endif %}
                            {% for holiday in day.holidays %}
                                <div class="holiday-badge">{{ holiday.reason }}</div>
                            {% endfor %}
                        </div>
                    {% endfor %}
                </div>
            {% endfor %}
        </div>
    </section>

    <section class="panel-card">
        <h2>Yeni Tatil Ekle</h2>
        <form method="post">
            {% csrf_token %}
            <input type="hidden" name="form_type" value="add_holiday">
            {{ holiday_form.as_p }}
            <button type="submit" class="primary">Tatil Ekle</button>
        </form>
    </section>
</div>

<script>
// Tema Yönetimi
(function() {
    const savedTheme = localStorage.getItem('theme') || 'dark';
    document.documentElement.setAttribute('data-theme', savedTheme);
    const themeButtons = document.querySelectorAll('.theme-btn');
    themeButtons.forEach(btn => {
        if (btn.dataset.theme === savedTheme) {
            btn.classList.add('active');
        } else {
            btn.classList.remove('active');
        }
    });
    themeButtons.forEach(btn => {
        btn.addEventListener('click', function() {
            const theme = this.dataset.theme;
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
            themeButtons.forEach(b => b.classList.remove('active'));
            this.classList.add('active');
        });
    });
})();

// Mesajların otomatik kapanması
(function() {
    const messages = document.querySelectorAll('.message');
    messages.forEach(message => {
        // 5 saniye sonra otomatik kapan
        setTimeout(() => {
            message.style.opacity = '0';
            message.style.transform = 'translateY(-20px)';
            setTimeout(() => {
                message.remove();
            }, 400);
        }, 5000);
    });
})();
</script>
</body>
</html>

