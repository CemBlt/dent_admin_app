{% extends 'panel/base.html' %}

{% block top_bar_subtitle %}Merhaba, yönetici{% endblock %}

{% block content %}
    <section class="kpi-grid">
        {% for card in kpi_cards %}
            <article class="kpi-card">
                <span class="pill" style="background: {{ card.color }}33; color: {{ card.color }};">{{ card.title }}</span>
                <div class="value">{{ card.value }}</div>
                <p style="margin:0;" class="muted-text">{{ card.description }}</p>
            </article>
        {% endfor %}
    </section>

    <section class="grid-two-columns">
        <article class="panel-card">
            <h2><i class="bi bi-calendar-check"></i> Bugünkü Randevular</h2>
            {% if todays_appointments %}
                <ul class="appointments-list">
                    {% for item in todays_appointments %}
                        <li class="appointment-item">
                            <div>
                                <strong>{{ item.time }}</strong>
                                <p style="margin:2px 0 0; font-size:13px;">{{ item.patient }} • {{ item.service }}</p>
                                <p style="margin:0; font-size:12px;" class="muted-text">{{ item.doctor }}</p>
                            </div>
                            <span class="status-chip status-{{ item.status }}">{{ item.status }}</span>
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p class="empty-state">Bugün için randevu yok.</p>
            {% endif %}
        </article>
        <article class="panel-card">
            <h2><i class="bi bi-people"></i> Doktor Durumu</h2>
            {% if doctor_status %}
                <ul class="doctor-list">
                    {% for doctor in doctor_status %}
                        <li class="doctor-item">
                            <div>
                                <strong>{{ doctor.name }}</strong>
                                <p style="margin:2px 0 0; font-size:12px;" class="muted-text">{{ doctor.specialty }}</p>
                            </div>
                            <span class="badge" style="background: {% if doctor.is_available %}#C4F1BE{% else %}#FECACA{% endif %};">
                                {{ doctor.status }}
                            </span>
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p class="empty-state">Doktor bulunamadı.</p>
            {% endif %}
        </article>
    </section>

    <section class="grid-two-columns">
        <article class="panel-card">
            <h2><i class="bi bi-graph-up"></i> Hizmet Performansı</h2>
            {% if service_stats %}
                <ul class="service-list">
                    {% for service in service_stats %}
                        <li class="service-item">
                            <div style="flex:1;">
                                <strong>{{ service.name }}</strong>
                                <div class="progress-bar">
                                    <span style="width: {{ service.percent }}%"></span>
                                </div>
                            </div>
                            <span style="font-weight:600;">{{ service.count }}</span>
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p class="empty-state">Hizmet verisi bulunamadı.</p>
            {% endif %}
        </article>
        <article class="panel-card">
            <h2><i class="bi bi-star-fill"></i> Doktor Puanları</h2>
            {% if doctor_ratings %}
                <ul class="doctor-ratings-list">
                    {% for doctor in doctor_ratings %}
                        <li class="doctor-rating-item">
                            <div style="flex: 1;">
                                <strong>{{ doctor.name }}</strong>
                                <p style="margin:2px 0 0; font-size:12px;" class="muted-text">{{ doctor.specialty }}</p>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <div style="display: flex; align-items: center; gap: 4px;">
                                    <i class="bi bi-star-fill" style="color: #FBBF24;"></i>
                                    <span style="font-weight: 600; font-size: 16px;">{{ doctor.rating }}</span>
                                </div>
                                {% if doctor.rating_count > 0 %}
                                    <span style="font-size: 12px; color: var(--text-secondary);">({{ doctor.rating_count }})</span>
                                {% else %}
                                    <span style="font-size: 12px; color: var(--text-secondary);">(Puan yok)</span>
                                {% endif %}
                            </div>
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p class="empty-state">Doktor bulunamadı.</p>
            {% endif %}
        </article>
    </section>

    <section class="grid-two-columns">
        <article class="panel-card">
            <h2><i class="bi bi-chat-dots"></i> Son Yorumlar</h2>
            {% if latest_reviews %}
                <ul class="review-list">
                    {% for review in latest_reviews %}
                        <li class="review-item">
                            <div>
                                <strong>{{ review.patient }}</strong>
                                <p style="margin:2px 0 4px; font-size:12px;" class="muted-text">{{ review.date }}</p>
                                <p style="margin:0; font-size:13px;">{{ review.comment }}</p>
                            </div>
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p class="empty-state">Henüz yorum bulunmuyor.</p>
            {% endif %}
        </article>
        <article class="panel-card">
            <h2><i class="bi bi-calendar-event"></i> Yaklaşan Tatiller</h2>
            {% if upcoming_holidays %}
                <ul class="holiday-list">
                    {% for holiday in upcoming_holidays %}
                        <li class="holiday-item">
                            <div>
                                <strong>{{ holiday.reason }}</strong>
                                <p style="margin:2px 0 0; font-size:12px;" class="muted-text">{{ holiday.date }}</p>
                            </div>
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p class="empty-state">Planlanan tatil bulunmuyor.</p>
            {% endif %}
        </article>
    </section>
{% endblock %}
